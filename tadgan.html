<!DOCTYPE html>
<html>
    <head>
        <title>Anomaly detection Testing Models</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <style>
            .my-flex {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        </style>
    </head>

    <script>

        function addOptions(select, vaules){
            // first delete previous options
            while (select.length > 0){
                select.remove(0)
            }

            for (const val of vaules){
                console.log(val)
                var opt = document.createElement('option');
                opt.value = val;
                opt.innerHTML = val;
                select.appendChild(opt);
            }
        }

        function setAggretionValues() {
            site_values = ["Tehran", "Mashhad", "Shiraz", "Tabriz"]
            rattype_values = ["E-Utran-LTE", "UTRAN-3G", "GERAN-2G", "WLAN", "HSPA Evolution", "Unknown"]

            var aggreagation_column_list = document.getElementById("aggregation_column");
            var aggreagation_values_list = document.getElementById("aggregation_value");
            aggreagation_column_name = aggreagation_column_list.options[aggreagation_column_list.selectedIndex].text;


            if (aggreagation_column_name == "site") {
                addOptions(aggreagation_values_list, site_values)
            }
            else {
                addOptions(aggreagation_values_list, rattype_values)
            }
        }

        function addImage(imageUrl, images){
            img = document.createElement("img")
            img.src = imageUrl
            images.appendChild(img)
        }

        function getImages(){
            url = "http://vps2.siavoshani.ir:60800/api/v1/data/aggregation/"
            var aggreagation_column_list = document.getElementById("aggregation_column");
            var aggreagation_values_list = document.getElementById("aggregation_value");
            data = {
                aggregation_column_name: aggreagation_column_list.options[aggreagation_column_list.selectedIndex].text,
                aggregation_value: aggreagation_values_list.options[aggreagation_values_list.selectedIndex].text
            }
            fetch(url, {method:'POST', headers: {'Accept': 'application/json','Content-Type': 'application/json'}, body: JSON.stringify(data)})
                .then(response => response.json())
                .then(json_resp => {
                    console.log(json_resp)
                    images = document.getElementById("images")
                    while (images.childNodes.length > 0){
                        images.removeChild(images.childNodes[0])
                    }
                    for (const val of json_resp){
                        addImage(val, images)
                    }
                })
        }
    </script>

    <body>
        <div class="my-flex">
            <div class="banner">
            <h1>TAD-GAN model test</h1>
            </div>
            <h2>TAD-GAN</h2>


                    <form action="http://vps2.siavoshani.ir:60800/static/statistical.html">
                        <input class="btn btn-info btn-sm" type="submit" value="Statistical model" />
                    </form>


            <b> Select the column name for aggregation: </b>
        <select class="form-select" id="aggregation_column" onchange = "setAggretionValues()" >
            <option> site </option>
            <option> rattype </option>
        </select>
        <br>
            <b> Select the aggregation value: </b>
        <select class="form-select" id="aggregation_value">
            <option> Tehran </option>
            <option> Mashhad </option>
            <option> Shiraz </option>
            <option> Isfahan </option>
        </select>
        <br>


            <button class="btn btn-primary btn-sm" onclick="getImages()">Get Graphs</button>
            <br>
        </div>
            <div id="images"></div>
    </body>
</html>
