<!DOCTYPE html>
<html>
    <head>
        <title>Anomaly detection Testing Models</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <style>
            .my-flex {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        </style>
    </head>

  <script>

function addOptions(select, vaules){
    // first delete previous options
    while (select.length > 0){
        select.remove(0)
    }

    for (const val of vaules){
        console.log(val)
        var opt = document.createElement('option');
        opt.value = val;
        opt.innerHTML = val;
        select.appendChild(opt);
    }
}

function setFilterValues() {
    filter_values = {
        "province": ["ALBORZ", "BUSHEHR", "TEHRAN", "KHOUZESTAN", "CHAHARMAHAL BAKHTIARI", "ARDABIL", "EAST AZERBAIJAN"],
        "cbp": ["105", "113", "123", "133", "143", "103"],
        "ratinggroup": ["100- Rubika", "10- Half-Price", "4"],
    }

    var filter_type_list = document.getElementById("aggregation_column");
    var filter_values_list = document.getElementById("aggregation_value");
    var aggregation_column_name = filter_type_list.options[filter_type_list.selectedIndex].text;

    addOptions(filter_values_list, filter_values[aggregation_column_name])
}

function addImage(imageUrl, images){
    img = document.createElement("img")
    img.src = imageUrl
    images.appendChild(img)
}

function getImages(){
    url = "http://vps2.siavoshani.ir:60800/api/v1/data/filter/"
    var aggreagation_column_list = document.getElementById("aggregation_column");
    var aggreagation_values_list = document.getElementById("aggregation_value");
    var prediction_models_select = document.getElementById("prediction_model");
    data = {
        filter_type: aggreagation_column_list.options[aggreagation_column_list.selectedIndex].text,
        filter_value: aggreagation_values_list.options[aggreagation_values_list.selectedIndex].text,
        prediction_model: prediction_models_select.options[prediction_models_select.selectedIndex].text
    }
    fetch(url, {method:'POST', headers: {'Accept': 'application/json','Content-Type': 'application/json'}, body: JSON.stringify(data)})
        .then(response => response.json())
        .then(json_resp => {
            console.log(json_resp)
            images = document.getElementById("images")
            while (images.childNodes.length > 0){
                images.removeChild(images.childNodes[0])
            }
            for (const val of json_resp){
                addImage(val, images)
            }
        })
}
</script>
<body>
        <div class="my-flex">
        <div class="banner">
        <h1>Statistical model test</h1>
        </div>
        <h2>Statistical model</h2>


        <form action="http://vps2.siavoshani.ir:60800/static/tadgan.html">
            <input class="btn btn-info btn-sm" type="submit" value="TAD-GAN" />
        </form>



<b> Select filter type: </b>
<select class="form-select" id="aggregation_column" onchange = "setFilterValues()" >
    <option> province </option>
    <option> cbp </option>
    <option> ratinggroup </option>
</select>
<br>
<b> Select the filter value: </b>
<select class="form-select" id="aggregation_value">
    <option> ALBORZ </option>
    <option> BUSHEHR </option>
    <option> TEHRAN </option>
    <option> KHOUZESTAN </option>
    <option> CHAHARMAHAL BAKHTIARI </option>
    <option> ARDABIL </option>
    <option> EAST AZERBAIJAN </option>
</select>

<br>
<b> Select the prediction model: </b>
<select class="form-select" id="prediction_model">
    <option> lstm </option>
    <option> sarima </option>
    <option> fbprophet </option>
</select>
<br>


<button class="btn btn-primary btn-sm" onclick="getImages()">Get Graphs</button>
</div>
<br>
<div id="images"></div>
</body>
</html>
